<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Perfil do Usuário — Surreal (Azul)</title>

  <!-- Fontes e ícones -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <link href="https://unpkg.com/lucide-static/font/lucide.css" rel="stylesheet">

  <!-- Supabase (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <meta name="color-scheme" content="light dark">
  <style>
    /* ---------- PALETA AZUL PREMIUM (REVISADA) ---------- */
    :root {
      --bg-1: #0a192f;          /* Deep space blue */
      --bg-2: #112240;          /* Slightly lighter navy */
      --card-bg: rgba(10, 25, 47, 0.6);
      --card-border: rgba(56, 139, 253, 0.15);
      --accent: #64b5f6;        /* Soft sky blue */
      --accent-hover: #42a5f5;  /* Slightly deeper on hover */
      --text: #e6f4ff;
      --muted: #8ab4f8;
      --shadow: 0 10px 30px rgba(0, 30, 60, 0.4);
      --shadow-hover: 0 12px 40px rgba(0, 40, 80, 0.5);
      --rounded: 16px;
      --focus-ring: 0 0 0 4px rgba(66, 165, 245, 0.25);
    }

    /* Light mode (opcional, mas mantido) */
    :root.light {
      --bg-1: #eef7ff;
      --bg-2: #dbebff;
      --card-bg: #ffffff;
      --card-border: rgba(100, 181, 246, 0.2);
      --text: #0a2e5c;
      --muted: #5a8fd9;
    }

    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Inter', 'Poppins', system-ui, sans-serif;
      background: linear-gradient(135deg, var(--bg-1), var(--bg-2));
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .wrap {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .profile {
      width: 960px;
      max-width: 96%;
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 32px;
      padding: 32px;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: var(--rounded);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      position: relative;
    }

    /* Left Column */
    .left {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    .avatar-wrap {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      padding: 4px;
      background: linear-gradient(135deg, var(--accent), #2196f3);
      box-shadow: 0 8px 24px rgba(0, 30, 60, 0.5);
    }

    .avatar {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid var(--bg-1);
      background: var(--bg-2);
    }

    .name h1 {
      margin: 0;
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: -0.3px;
    }

    .name p {
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 0.92rem;
    }

    .badges {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .badge {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--accent);
      background: rgba(100, 181, 246, 0.1);
      border: 1px solid rgba(100, 181, 246, 0.2);
    }

    /* Right Column */
    .right {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
    }

    .email {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.95rem;
      color: var(--muted);
    }

    .controls {
      display: flex;
      gap: 12px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.05);
      color: var(--text);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.2s ease;
      min-height: 44px;
    }

    .btn.ghost {
      background: transparent;
      border-color: rgba(255, 255, 255, 0.2);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }

    .btn:focus {
      outline: none;
      box-shadow: var(--focus-ring);
    }

    .btn.primary {
      background: linear-gradient(135deg, var(--accent), #42a5f5);
      color: #0a192f;
      border: none;
      box-shadow: 0 6px 20px rgba(66, 165, 245, 0.3);
    }

    .btn.primary:hover {
      background: linear-gradient(135deg, #42a5f5, #1e88e5);
    }

    .stats {
      display: flex;
      gap: 16px;
    }

    .stat {
      flex: 1;
      padding: 16px;
      text-align: center;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .stat h3 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 700;
    }

    .stat p {
      margin: 8px 0 0;
      color: var(--muted);
      font-size: 0.85rem;
    }

    .topics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 16px;
    }

    .topic {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.05);
      color: var(--text);
      text-decoration: none;
      transition: all 0.25s ease;
    }

    .topic:hover {
      transform: translateY(-4px);
      background: rgba(100, 181, 246, 0.1);
      border-color: rgba(100, 181, 246, 0.3);
      box-shadow: 0 8px 24px rgba(0, 30, 60, 0.3);
    }

    .topic i {
      font-size: 20px;
      color: var(--accent);
    }

    .topic strong {
      display: block;
      font-weight: 600;
      font-size: 0.95rem;
    }

    .topic .muted {
      font-size: 0.8rem;
    }

    /* Modal de Edição */
    .modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(10, 25, 47, 0.85);
      backdrop-filter: blur(8px);
      z-index: 100;
      padding: 20px;
    }

    .modal-card {
      width: 600px;
      max-width: 95%;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: var(--rounded);
      padding: 24px;
      box-shadow: var(--shadow);
    }

    .modal-card h3 {
      margin: 0 0 16px;
      font-weight: 700;
    }

    .modal-card input {
      width: 100%;
      padding: 12px;
      margin: 6px 0 16px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(0, 0, 0, 0.2);
      color: var(--text);
      font-family: inherit;
    }

    .modal-card input::placeholder {
      color: var(--muted);
    }

    /* Welcome Modal (melhorada) */
    .welcome-modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, rgba(2,6,23,0.75), rgba(2,6,23,0.85));
      backdrop-filter: blur(6px) saturate(1.1);
      z-index: 200;
      padding: 20px;
    }

    .welcome-card {
      display: flex;
      gap: 24px;
      width: 820px;
      max-width: 96%;
      max-height: 80vh;
      background: linear-gradient(180deg, rgba(12,28,48,0.7), rgba(8,20,36,0.6));
      border: 1px solid rgba(100, 181, 246, 0.14);
      border-radius: 20px;
      padding: 28px;
      box-shadow: 0 22px 60px rgba(0, 20, 40, 0.6);
      position: relative;
      overflow: hidden;
    }

    .welcome-left { 
      flex: 1; 
      scroll-behavior: smooth;
      transition: opacity 220ms ease, transform 220ms ease; 
      max-height: 400px;
      overflow-y: auto;
      padding-right: 8px;
      scrollbar-width: thin;
      scrollbar-color: rgba(100, 181, 246, 0.5) transparent;
    }

    .welcome-left::-webkit-scrollbar {
      width: 6px;
    }

    .welcome-left::-webkit-scrollbar-track {
      background: transparent;
    }

    .welcome-left::-webkit-scrollbar-thumb {
      background: rgba(100, 181, 246, 0.5);
      border-radius: 3px;
    }

    .welcome-right { 
      position: absolute;
      bottom: 28px;
      right: 28px;
      width: 200px;
      height: 60px;
      flex-shrink: 0;
      max-height: 60px;
      overflow: hidden;
      scrollbar-width: thin;
      scrollbar-color: rgba(100, 181, 246, 0.5) transparent;
      transition: all 0.3s ease;
    }

    .welcome-right::-webkit-scrollbar {
      width: 6px;
    }

    .welcome-right::-webkit-scrollbar-track {
      background: transparent;
    }

    .welcome-right::-webkit-scrollbar-thumb {
      background: rgba(100, 181, 246, 0.5);
      border-radius: 3px;
    }

    .welcome-badge {
      padding: 8px 14px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--accent), #42a5f5);
      color: #0a192f;
      font-weight: 800;
      font-size: 0.88rem;
      display:inline-block;
    }

    .welcome-title {
      font-size: 2rem;
      margin: 12px 0 6px;
      font-weight: 900;
      line-height: 1.05;
      color: var(--text);
    }

    .welcome-sub {
      color: var(--muted);
      margin-top: 10px;
      line-height: 1.5;
    }

    /* --- NOVO: Estilo aprimorado para o painel de desenvolvedores --- */
    .hero-plate {
      width: 100%;
      height: 100%;
      min-height: 60px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(100, 181, 246, 0.1), rgba(66, 165, 245, 0.05));
      border: 1px solid var(--card-border);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      gap: 10px;
      color: var(--text);
      padding: 12px;
      text-align: center;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.03);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .hero-plate:hover {
      background: linear-gradient(135deg, rgba(100, 181, 246, 0.15), rgba(66, 165, 245, 0.1));
      border-color: rgba(100, 181, 246, 0.3);
    }

    .hero-plate.expanded {
      position: absolute;
      inset: 0;
      min-height: auto;
      padding: 40px 28px;
      border-radius: 20px;
      z-index: 5;
      display: flex !important;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
      gap: 20px;
      box-shadow: none;
    }

    .hero-plate.expanded .hero-title {
      margin-bottom: 12px;
      text-align: left;
      font-size: 1.4rem;
    }

    .dev-list {
      list-style: none;
      margin: 8px 0 0;
      padding: 0;
      width: 100%;
      display: none;
      flex-direction: column;
      gap: 12px;
      max-height: none;
    }

    .hero-plate.expanded .dev-list {
      display: flex;
      flex: 1;
      overflow-y: auto;
      margin-top: 20px;
    }

    .dev-name {
      display: block;
      font-weight: 600;
      font-size: 1rem;
      color: var(--text);
      padding: 12px 16px;
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(2px);
      transition: background 0.2s ease;
      text-align: left;
    }

    .dev-name:hover {
      background: rgba(100, 181, 246, 0.15);
      color: var(--accent);
    }

    /* Light mode adjustments */
    :root.light .hero-plate {
      background: linear-gradient(135deg, rgba(200, 230, 255, 0.3), rgba(220, 240, 255, 0.2));
      border-color: rgba(100, 181, 246, 0.2);
    }

    :root.light .hero-plate.expanded {
      background: linear-gradient(135deg, rgba(200, 230, 255, 0.4), rgba(220, 240, 255, 0.3));
      border-color: rgba(100, 181, 246, 0.3);
    }

    :root.light .dev-name {
      background: rgba(0, 0, 0, 0.03);
      color: var(--text);
    }

    :root.light .dev-name:hover {
      background: rgba(100, 181, 246, 0.2);
      color: #0a2e5c;
    }
    /* --- FIM da melhoria --- */

    .welcome-close {
      position: absolute;
      top: 12px;
      right: 12px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 12px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      z-index: 10;
      transition: all 0.2s ease;
      color: var(--text);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .welcome-close:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
      box-shadow: var(--shadow);
    }

    .welcome-close:focus {
      outline: none;
      box-shadow: var(--focus-ring);
    }

    .welcome-close i {
      font-size: 1.2rem;
    }

    /* Confete */
    .confetti-wrap {
      pointer-events: none;
      position: absolute;
      inset: 0;
      z-index: 400;
      overflow: visible;
    }

    .confetti-piece {
      position: absolute;
      top: 0;
      width: 10px;
      height: 14px;
      border-radius: 2px;
      opacity: 0.95;
      transform-origin: center;
      will-change: transform, opacity;
      animation-name: confetti-fall;
      animation-timing-function: cubic-bezier(.2,.7,.3,1);
      animation-fill-mode: forwards;
    }

    @keyframes confetti-fall {
      0% { transform: translate3d(0,-10px,0) rotate(0deg) scale(1); opacity: 1; }
      100% { transform: translate3d(var(--dx, 0px), 260px, 0) rotate(var(--rot, 360deg)) scale(0.95); opacity: 0; }
    }

    /* Responsive */
    @media (max-width: 900px) {
      .profile { 
        grid-template-columns: 1fr; 
        padding: 20px; 
        gap: 24px;
      }
      .left { order: 1; }
      .right { order: 2; }
      .avatar-wrap { width: 130px; height: 130px; }
      .welcome-modal { padding: 16px; }
      .welcome-card { 
        flex-direction: column; 
        gap: 16px; 
        width: 100%; 
        max-width: 100%; 
        max-height: 85vh;
        padding: 20px; 
        border-radius: 16px; 
      }
      .welcome-left { 
        flex: 1; 
        min-width: 0;
        max-height: 300px;
      }
      .welcome-right { 
        position: static;
        width: 100%;
        height: 60px;
        bottom: auto;
        right: auto;
        max-height: 60px;
      }
      .welcome-title { 
        font-size: 1.6rem;
        line-height: 1.1;
      }
      .welcome-sub { 
        font-size: 0.95rem;
        line-height: 1.4;
      }
      .hero-plate { 
        min-height: 50px; 
        padding: 10px; 
        gap: 8px;
      }
      .hero-plate.expanded {
        position: relative;
        inset: auto;
        width: 100%;
        height: auto;
        padding: 20px 16px;
        flex: 1;
        min-height: 200px;
      }
      .hero-plate.expanded .dev-list {
        gap: 8px;
        margin-top: 16px;
      }
      .hero-title { font-size: 1.1rem; }
      .dev-list { gap: 6px; }
      .dev-name { 
        font-size: 0.95rem; 
        padding: 10px 12px; 
      }
      .topbar { flex-direction: column; align-items: stretch; gap: 12px; }
      .controls { justify-content: center; }
    }

    @media (max-width: 480px) {
      .wrap { padding: 16px; }
      .profile { padding: 16px; gap: 20px; }
      .avatar-wrap { width: 110px; height: 110px; }
      .name h1 { font-size: 1.3rem; }
      .stats { flex-direction: column; }
      .welcome-modal { padding: 12px; }
      .welcome-card { 
        gap: 12px; 
        padding: 16px; 
        border-radius: 12px; 
        max-height: 90vh;
      }
      .welcome-left { 
        flex: 1; 
        max-height: 250px;
      }
      .welcome-right { 
        height: 50px;
        max-height: 50px;
      }
      .welcome-title { 
        font-size: 1.3rem; 
      }
      .welcome-sub { 
        font-size: 0.9rem; 
        margin-top: 8px;
      }
      .welcome-badge { 
        font-size: 0.8rem; 
        padding: 6px 12px; 
      }
      .hero-plate { 
        min-height: 50px; 
        padding: 8px; 
        gap: 6px;
      }
      .hero-plate.expanded {
        padding: 16px 12px;
        gap: 16px;
      }
      .hero-title { font-size: 1rem; }
      .dev-list { gap: 4px; }
      .dev-name { 
        font-size: 0.9rem; 
        padding: 8px 10px; 
      }
      .welcome-title { font-size: 1.2rem; }
      .topics-grid { 
        grid-template-columns: 1fr; 
        gap: 12px; 
      }
      .topic { 
        padding: 16px; 
        flex-direction: column; 
        text-align: center; 
        gap: 8px;
      }
      .topic i { font-size: 24px; }
      .btn { 
        padding: 12px 18px; 
        font-size: 0.9rem; 
        justify-content: center;
      }
      .modal-card { padding: 20px; }
    }

    .muted { color: var(--muted); }
    .small { font-size: 0.85rem; }
    .center { display: flex; align-items: center; justify-content: center; }
  </style>
</head>
<body>

  <div class="wrap">
    <main class="profile" id="profileCard" role="region" aria-label="Perfil do usuário">

      <!-- LEFT -->
      <section class="left" aria-hidden="false">
        <div class="avatar-wrap center" id="avatarWrap">
          <img id="avatar" class="avatar" src="" alt="Foto do usuário" />
        </div>

        <div class="name" id="nameBlock">
          <h1 id="userName">Carregando...</h1>
          <p id="userTag" class="muted">— Perfil público</p>
        </div>

        <div style="width:100%;display:flex;gap:8px;justify-content:center;margin-top:12px">
          <button class="btn ghost" id="editBtn" title="Editar perfil"><i class="lucide-edit-2"></i> Editar</button>
          <button class="btn ghost" id="logoutBtn" title="Sair"><i class="lucide-log-out"></i> Sair</button>
        </div>
      </section>

      <!-- RIGHT -->
      <section class="right" aria-hidden="false">
        <div class="topbar">
          <div class="email">
            <i class="lucide-mail"></i>
            <span id="userEmail" class="small muted">—@—</span>
          </div>
        </div>

        <div>
          <h4 style="margin:10px 0 8px; font-weight:600">Navegue: Estude rápido</h4>
          <div class="topics-grid" id="topicsGrid" aria-label="Tópicos de redes">
            <!-- preenchido por JS -->
          </div>
        </div>

        <div style="margin-top:8px;display:flex;justify-content:flex-end">
          <button class="btn ghost" id="refreshBtn"><i class="lucide-refresh-cw"></i> Recarregar</button>
        </div>
      </section>
    </main>
  </div>

  <!-- Modal de edição -->
  <div id="modal" class="modal" style="display:none" role="dialog" aria-modal="true" aria-label="Editar perfil">
    <div class="modal-card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <h3>Editar perfil</h3>
        <button class="btn" id="closeModal"><i class="lucide-x"></i></button>
      </div>
      <div style="display:flex;gap:12px;flex-direction:column">
        <label class="small">Nome</label>
        <input id="editName" type="text" placeholder="Seu nome" />
        <label class="small">Email</label>
        <input id="editEmail" type="email" placeholder="seu@exemplo.com" />
        <label class="small">URL da imagem (opcional)</label>
        <input id="editPic" type="text" placeholder="https://..." />
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
          <button class="btn primary" id="saveProfile">Salvar</button>
          <button class="btn ghost" id="cancelEdit">Cancelar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- WELCOME MODAL (ATUALIZADO COM NOVA LISTA DE DESENVOLVEDORES) -->
  <div id="welcomeModal" class="welcome-modal" style="display:none" role="dialog" aria-modal="true" aria-label="Bem-vindo ao Perfil">
    <div class="welcome-card" role="document">
      <button class="btn welcome-close" id="welcomeClose" title="Fechar"><i class="lucide-x"></i></button>

      <div class="welcome-left">
        <div class="welcome-badge">Seja bem-vindo(a)</div>
        <h2 class="welcome-title">Olá! É ótimo ter você por aqui.</h2>
        <p class="welcome-sub">Bem-vindo ao Mundo das Redes de Computadores!<br><br>
Descubra de forma simples e prática como os computadores se conectam, trocam dados e formam a rede que impulsiona nossa comunicação digital diária.<br><br>
Nosso objetivo: mostrar a importância das redes na sociedade moderna e como elas viabilizam o mundo conectado que conhecemos.</p>

        <label class="small" style="margin-top:12px;display:block"><input id="dontShow" type="checkbox" style="margin-right:8px"> Não mostrar novamente</label>
      </div>

      <div class="welcome-right">
        <!-- Agora é um botão -->
        <button class="hero-plate" id="devToggleBtn">
          <h3 class="hero-title">Equipe de Desenvolvimento</h3>
          <ul class="dev-list" id="devList" aria-label="Lista de desenvolvedores">
            <li><span class="dev-name">Raquele de Jesus Santos</span></li>
            <li><span class="dev-name">Átila Santos Bispo</span></li>
            <li><span class="dev-name">Ana Caroline de Jesus</span></li>
            <li><span class="dev-name">Clícia Moraes de Lima</span></li>
            <li><span class="dev-name">Adriele Pereira Faustino</span></li>
            <li><span class="dev-name">Raiane Calvalcante Santos</span></li>
          </ul>
        </button>
      </div>

      <!-- Confete container (inserido dinamicamente) -->
      <div class="confetti-wrap" id="confettiWrap" aria-hidden="true"></div>
    </div>
  </div>

  <!-- Scripts (com melhorias para confetes) -->
  <script>
    const SUPABASE_URL = 'https://zszcwubydhgoyhxbxfro.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpzemN3dWJ5ZGhnb3loeGJ4ZnJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4MDk5MDMsImV4cCI6MjA3NTM4NTkwM30.ryioOoPAZnZzGdcTxIjfUcSlYUUqa7arA4qlUukyV7M';
    const { createClient } = window.supabase;
    const supabase = createClient(SUPABASE_URL.trim(), SUPABASE_ANON_KEY.trim());

    function parseJwt(token){ try{ const base64 = token.split('.')[1].replace(/-/g,'+').replace(/_/g,'/'); return JSON.parse(atob(base64)); }catch(e){return null} }

    const avatar = document.getElementById('avatar');
    const userName = document.getElementById('userName');
    const userEmail = document.getElementById('userEmail');
    const userTag = document.getElementById('userTag');
    const topicsGrid = document.getElementById('topicsGrid');
    const profileCard = document.getElementById('profileCard');

    const topicos = [
      {href:'oque-e.html', icon:'lucide-network', title:'O que é Redes de Computadores'},
      {href:'historia.html', icon:'lucide-book', title:'História das Redes'},
      {href:'como-funciona.html', icon:'lucide-cpu', title:'Como Funciona'},
      {href:'tipos.html', icon:'lucide-layers', title:'Tipos de Rede'},
      {href:'dispositivos.html', icon:'lucide-router', title:'Dispositivos'},
      {href:'topologia.html', icon:'lucide-share-2', title:'Topologias'},
      {href:'protocolos.html', icon:'lucide-code', title:'Protocolos'},
      {href:'camadas.html', icon:'lucide-layers-3', title:'Camadas'},
      {href:'seguranca.html', icon:'lucide-shield-check', title:'Segurança'}
    ];

    function renderTopics(){ topicsGrid.innerHTML=''; for(const t of topicos){ const el = document.createElement('a'); el.className='topic'; el.href=t.href; el.innerHTML = `<i class="${t.icon}"></i><div><strong>${t.title}</strong><span class="muted small">Abrir</span></div>`; topicsGrid.appendChild(el);} }

    const modal = document.getElementById('modal');
    const editBtn = document.getElementById('editBtn');
    const closeModal = document.getElementById('closeModal');
    const cancelEdit = document.getElementById('cancelEdit');
    const saveProfile = document.getElementById('saveProfile');
    const editName = document.getElementById('editName');
    const editEmail = document.getElementById('editEmail');
    const editPic = document.getElementById('editPic');

    editBtn.addEventListener('click', () => { modal.style.display = 'flex'; editName.value = userName.textContent === 'Carregando...' ? '' : userName.textContent; editEmail.value = userEmail.textContent.includes('@') ? userEmail.textContent : ''; editPic.value = avatar.src || ''; });
    [closeModal, cancelEdit].forEach(btn => { btn.addEventListener('click', () => modal.style.display = 'none'); });

    saveProfile.addEventListener('click', async () => {
      const nome = editName.value.trim(); const email = editEmail.value.trim(); const pic = editPic.value.trim();
      if(nome) userName.textContent = nome; if(email) userEmail.textContent = email; if(pic) loadAvatar(pic);
      modal.style.display = 'none';
      if(email){ try{ const { error } = await supabase.from('dadoscetep').update({ nome, picture: pic }).eq('email', email); if(error) console.warn('Erro ao salvar:', error); }catch(err){console.warn('Erro ao salvar no Supabase:', err);} }
    });

    function loadAvatar(url){ avatar.src = url || 'imagen/default.png'; }

    async function carregarPerfil(){ let email = localStorage.getItem('userEmail'); if(!email){ const token = localStorage.getItem('googleToken'); const payload = parseJwt(token); email = payload?.email; }
      if(!email){ userName.textContent = 'Convidado'; userTag.textContent = 'Faça login para ver seu perfil'; userEmail.textContent = '—'; loadAvatar('imagen/default.png'); renderTopics(); return; }

      userEmail.textContent = email; userName.textContent = 'Carregando...';

      try{
        const { data, error } = await supabase.from('dadoscetep').select('nome, email, picture, created_at').eq('email', email).single();
        if(error || !data){ console.warn('Usuário não encontrado:', error); userName.textContent = email.split('@')[0]; userTag.textContent = 'Perfil básico'; loadAvatar('imagen/default.png'); }
        else{ userName.textContent = data.nome || email.split('@')[0]; userEmail.textContent = data.email || email; userTag.textContent = 'Bem-vindo(a)'; loadAvatar(data.picture || 'imagen/default.png'); }
      }catch(err){ console.error('Erro crítico:', err); userName.textContent = email.split('@')[0]; userTag.textContent = 'Erro ao conectar'; loadAvatar('imagen/default.png'); }
      finally{ renderTopics(); profileCard.animate([{ transform: 'scale(0.998)' }, { transform: 'scale(1)' }], { duration: 300, easing: 'ease-out' }); }
    }

    document.getElementById('refreshBtn').addEventListener('click', carregarPerfil);
    document.getElementById('logoutBtn').addEventListener('click', () => { localStorage.removeItem('userEmail'); localStorage.removeItem('googleToken'); location.href = 'index.html'; });

    const welcomeModal = document.getElementById('welcomeModal');
    const welcomeClose = document.getElementById('welcomeClose');
    const dontShow = document.getElementById('dontShow');
    const confettiWrap = document.getElementById('confettiWrap');

    function random(min, max){ return Math.random() * (max - min) + min; }

    function launchConfetti(){
      confettiWrap.innerHTML = '';
      const colors = ['#ff3b3b','#ffd23f','#64b5f6','#7cf59b','#d69df7','#ff8fa3'];
      const pieces = 42;
      for(let i=0;i<pieces;i++){
        const el = document.createElement('div');
        el.className = 'confetti-piece';
        const left = Math.floor(random(5,95));
        const dx = Math.floor(random(-80,80));
        const rot = Math.floor(random(180,1080));
        const delay = (random(0,0.6)).toFixed(2) + 's';
        const duration = (random(0.9,1.6)).toFixed(2) + 's';
        el.style.left = left + '%';
        el.style.background = colors[i % colors.length];
        el.style.setProperty('--dx', dx + 'px');
        el.style.setProperty('--rot', rot + 'deg');
        el.style.animationDelay = delay;
        el.style.animationDuration = duration;
        if(Math.random() > 0.5){ el.style.width = '12px'; el.style.height = '8px'; }
        confettiWrap.appendChild(el);
      }
      setTimeout(()=>{ if(confettiWrap) confettiWrap.innerHTML = ''; }, 3000);
    }

    function showWelcome(){ const seen = localStorage.getItem('seenWelcome'); if(seen) return; welcomeModal.style.display = 'flex'; setTimeout(() => { welcomeClose.focus(); launchConfetti(); }, 180); }
    function hideWelcome(save){ welcomeModal.style.display = 'none'; if(save) localStorage.setItem('seenWelcome','1'); profileCard.animate([{ transform: 'scale(1)' }, { transform: 'scale(1.02)' }, { transform: 'scale(1)' }], { duration: 420, easing: 'ease-out' }); }
    welcomeClose.addEventListener('click', () => { hideWelcome(dontShow.checked); });

    // Nova funcionalidade: toggle entre "Equipe de Desenvolvimento" <-> "Boas-vindas"
    const devToggleBtn = document.getElementById('devToggleBtn');
    const welcomeLeft = document.querySelector('.welcome-left');
    const welcomeBadge = document.querySelector('.welcome-badge');
    const welcomeTitle = document.querySelector('.welcome-title');
    const welcomeSub = document.querySelector('.welcome-sub');
    const dontShowContainer = dontShow.parentElement;
    const originalHeroTitleText = (devToggleBtn.querySelector('.hero-title') || {}).textContent || 'Equipe de Desenvolvimento';

    // referência original da lista de desenvolvedores (mantida dentro do botão)
    const devListOriginal = document.getElementById('devList');

    // variável para o clone que será inserido dentro do welcome-left
    let devListClone = null;

    devToggleBtn.addEventListener('click', (e) => {
      const isActive = devToggleBtn.classList.contains('dev-active');
      const heroTitleEl = devToggleBtn.querySelector('.hero-title');

      if (!isActive) {
        // esconder o conteúdo de boas-vindas (mantendo os elementos no DOM)
        welcomeBadge.style.display = 'none';
        welcomeTitle.style.display = 'none';
        welcomeSub.style.display = 'none';
        dontShowContainer.style.display = 'none';

        // clonar a lista de devs e inserir na área da esquerda (onde estava o texto)
        if (devListOriginal) {
          devListClone = devListOriginal.cloneNode(true);
          devListClone.id = 'devListClone';
          devListClone.classList.add('dev-list-clone');
          devListClone.style.display = 'flex';
          // garante layout vertical e rolagem suave
          devListClone.style.maxHeight = '360px';
          devListClone.style.overflowY = 'auto';
          devListClone.style.paddingRight = '6px';
          welcomeLeft.appendChild(devListClone);

          // animação de entrada suave
          requestAnimationFrame(() => {
            devListClone.style.opacity = '1';
            devListClone.style.transform = 'translateY(0)';
          });
        }

        // marcar estado ativo e alterar texto do botão (acessível também)
        devToggleBtn.classList.add('dev-active');
        devToggleBtn.setAttribute('aria-pressed', 'true');
        if (heroTitleEl) heroTitleEl.textContent = 'Boas-vindas';
        devToggleBtn.title = 'Mostrar boas-vindas';
      } else {
        // voltar ao estado de boas-vindas
        welcomeBadge.style.display = '';
        welcomeTitle.style.display = '';
        welcomeSub.style.display = '';
        dontShowContainer.style.display = '';

        // animação de saída e remoção da lista
        if (devListClone) {
          devListClone.style.opacity = '0';
          devListClone.style.transform = 'translateY(6px)';
          setTimeout(() => { if (devListClone) { devListClone.remove(); devListClone = null; } }, 260);
        }

        // restaurar estado do botão
        devToggleBtn.classList.remove('dev-active');
        devToggleBtn.setAttribute('aria-pressed', 'false');
        if (heroTitleEl) heroTitleEl.textContent = originalHeroTitleText;
        devToggleBtn.title = 'Equipe de Desenvolvimento';
      }
    });

    document.addEventListener('keydown', (e) => { if(e.key === 'Escape' && welcomeModal.style.display === 'flex'){ hideWelcome(dontShow.checked); } });

    document.addEventListener('DOMContentLoaded', () => { try{ showWelcome(); }catch(e){ console.warn('Welcome failed:', e);} carregarPerfil(); });
  </script>
</body>
</html>